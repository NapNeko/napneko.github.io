import{_ as g,C as o,o as d,c as u,j as t,a as s,E as a,w as i,b as r,ar as h,aD as n}from"./chunks/framework.BeKdlGsR.js";const P=JSON.parse('{"title":"发布插件","description":"","frontmatter":{},"headers":[],"relativePath":"develop/plugin/publish.md","filePath":"develop/plugin/publish.md","lastUpdated":1770492615000}'),E={name:"develop/plugin/publish.md"},b={class:"tip custom-block"},m={class:"warning custom-block"};function A(B,e,y,C,F,f){const k=o("NolebasePageProperties"),l=o("VPNolebaseInlineLinkPreview"),p=o("Mermaid"),c=o("NolebaseGitChangelog");return d(),u("div",null,[e[33]||(e[33]=t("h1",{id:"发布插件",tabindex:"-1"},[s("发布插件 "),t("a",{class:"header-anchor",href:"#发布插件","aria-label":'Permalink to "发布插件"'},"​")],-1)),a(k),e[34]||(e[34]=t("p",null,"本章节将详细介绍如何通过 CI/CD 自动化流程发布你的 NapCat 插件，并将其收录到官方插件索引中。",-1)),t("div",b,[e[5]||(e[5]=t("p",{class:"custom-block-title"},"前提条件",-1)),t("ul",null,[t("li",null,[e[1]||(e[1]=s("你已经基于 ",-1)),a(l,{href:"https://github.com/NapNeko/napcat-plugin-template",target:"_blank",rel:"noreferrer"},{default:i(()=>[...e[0]||(e[0]=[s("napcat-plugin-template",-1)])]),_:1}),e[2]||(e[2]=s(" 创建了自己的插件仓库",-1))]),e[3]||(e[3]=t("li",null,"插件代码已经开发完成，并可以正常构建",-1)),e[4]||(e[4]=t("li",null,"你有一个 GitHub 账号",-1))])]),e[35]||(e[35]=t("h2",{id:"整体流程",tabindex:"-1"},[s("整体流程 "),t("a",{class:"header-anchor",href:"#整体流程","aria-label":'Permalink to "整体流程"'},"​")],-1)),e[36]||(e[36]=t("p",null,[s("整个发布流程是自动化的，只需完成两步操作："),t("strong",null,"配置 Secrets"),s(" 和 "),t("strong",null,"推送 tag"),s("。")],-1)),(d(),r(h,null,{default:i(()=>[a(p,{id:"mermaid-33",class:"mermaid my-class",graph:"flowchart%20LR%0A%20%20%20%20A%5B%22%E6%8E%A8%E9%80%81%20v*%20tag%22%5D%20--%3E%20B%5B%22CI%20%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%22%5D%0A%20%20%20%20B%20--%3E%20C%5B%22%E6%89%93%E5%8C%85%20zip%22%5D%0A%20%20%20%20C%20--%3E%20D%5B%22%E5%88%9B%E5%BB%BA%20GitHub%20Release%22%5D%0A%20%20%20%20D%20--%3E%20E%5B%22%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4%20PR%5Cn%E5%88%B0%E7%B4%A2%E5%BC%95%E4%BB%93%E5%BA%93%22%5D%0A%20%20%20%20E%20--%3E%20F%5B%22%E7%B4%A2%E5%BC%95%E4%BB%93%E5%BA%93%5CnCI%20%E8%87%AA%E5%8A%A8%E5%AE%A1%E6%A0%B8%22%5D%0A%20%20%20%20F%20--%3E%20G%5B%22%E7%BB%B4%E6%8A%A4%E8%80%85%E5%90%88%E5%B9%B6%22%5D%0A%0A%20%20%20%20style%20A%20fill%3A%234CAF50%2Ccolor%3A%23fff%0A%20%20%20%20style%20D%20fill%3A%232196F3%2Ccolor%3A%23fff%0A%20%20%20%20style%20G%20fill%3A%23FF9800%2Ccolor%3A%23fff%0A"})]),fallback:i(()=>[...e[6]||(e[6]=[s(" Loading... ",-1)])]),_:1})),e[37]||(e[37]=n(`<p>模板仓库内置了两个 GitHub Actions 工作流，分别负责：</p><table tabindex="0"><thead><tr><th>工作流文件</th><th>功能</th></tr></thead><tbody><tr><td><code>release.yml</code></td><td>自动构建项目、打包 zip、创建 GitHub Release</td></tr><tr><td><code>update-index.yml</code></td><td>Release 发布后，自动向插件索引仓库提交更新 PR</td></tr></tbody></table><h2 id="第一步-填写插件元信息" tabindex="-1">第一步：填写插件元信息 <a class="header-anchor" href="#第一步-填写插件元信息" aria-label="Permalink to &quot;第一步：填写插件元信息&quot;">​</a></h2><p>编辑你的 <code>package.json</code>，确保以下字段已正确填写：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark has-highlighted vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;napcat-plugin-your-name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 插件唯一 ID，必须以 napcat-plugin- 开头</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;plugin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;你的插件显示名&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 在插件市场中显示的名称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;插件功能描述&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;author&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;你的名字&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;napcat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {                              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 索引专用字段</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;工具&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 插件标签，见下方可用标签</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;minVersion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4.14.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 支持的最低 NapCat 版本</span></span>
<span class="line highlighted"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;homepage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                       // 留空则默认使用仓库地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="命名规范" tabindex="-1">命名规范 <a class="header-anchor" href="#命名规范" aria-label="Permalink to &quot;命名规范&quot;">​</a></h3><ul><li><code>name</code> 字段（即插件 ID）<strong>必须</strong>以 <code>napcat-plugin-</code> 开头</li><li>仅允许<strong>小写字母、数字和短横线</strong> <code>-</code>，禁止使用中文或大写字母</li><li>例如：<code>napcat-plugin-music</code>、<code>napcat-plugin-group-manager</code></li></ul><h3 id="可用标签" tabindex="-1">可用标签 <a class="header-anchor" href="#可用标签" aria-label="Permalink to &quot;可用标签&quot;">​</a></h3><p>以下标签可在 <code>napcat.tags</code> 数组中使用：</p><p><code>官方</code> <code>工具</code> <code>娱乐</code> <code>AI</code> <code>群管</code> <code>管理</code> <code>自动化</code> <code>语音</code> <code>表情</code> <code>撤回</code> <code>游戏</code> <code>音乐</code> <code>图片</code> <code>视频</code> <code>搜索</code> <code>翻译</code> <code>天气</code> <code>签到</code> <code>抽奖</code> <code>其他</code></p><h2 id="第二步-配置仓库-secrets" tabindex="-1">第二步：配置仓库 Secrets <a class="header-anchor" href="#第二步-配置仓库-secrets" aria-label="Permalink to &quot;第二步：配置仓库 Secrets&quot;">​</a></h2><p>在你的<strong>插件仓库</strong>的 <strong>Settings &gt; Secrets and variables &gt; Actions</strong> 中，需要添加以下 Secret：</p><h3 id="必选配置" tabindex="-1">必选配置 <a class="header-anchor" href="#必选配置" aria-label="Permalink to &quot;必选配置&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Secret 名称</th><th>说明</th></tr></thead><tbody><tr><td><code>INDEX_PAT</code></td><td>GitHub Personal Access Token，需要 <code>public_repo</code> 权限，用于向索引仓库提交 PR</td></tr></tbody></table><details class="details custom-block"><summary>如何创建 Personal Access Token (PAT)</summary><ol><li>进入 GitHub <strong>Settings &gt; Developer settings &gt; Personal access tokens &gt; Tokens (classic)</strong></li><li>点击 <strong>Generate new token (classic)</strong></li><li>设置名称，例如 <code>napcat-plugin-index</code></li><li>勾选 <code>public_repo</code> 权限（位于 <code>repo</code> 下）</li><li>设置合理的过期时间</li><li>点击 <strong>Generate token</strong>，<strong>立即复制并保存</strong>，此 Token 只会显示一次</li><li>回到你的插件仓库，在 <strong>Settings &gt; Secrets and variables &gt; Actions</strong> 中添加名为 <code>INDEX_PAT</code> 的 Secret，值为上一步复制的 Token</li></ol></details><h3 id="可选配置-ai-release-note" tabindex="-1">可选配置（AI Release Note） <a class="header-anchor" href="#可选配置-ai-release-note" aria-label="Permalink to &quot;可选配置（AI Release Note）&quot;">​</a></h3><p>如果你希望每次发布时自动用 AI 生成 Release Note，可以额外配置：</p><table tabindex="0"><thead><tr><th>Secret 名称</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td><code>AI_API_URL</code></td><td>是</td><td>兼容 OpenAI 格式的 API 地址（如 <code>https://api.openai.com/v1/chat/completions</code>）</td></tr><tr><td><code>AI_API_KEY</code></td><td>是</td><td>对应的 API 密钥</td></tr><tr><td><code>AI_MODEL</code></td><td>否</td><td>模型名称，默认 <code>gpt-4o-mini</code></td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>不配置 AI 相关 Secret 不影响发布流程。未配置或 AI 调用失败时，会自动回退到默认的 Release Note 模板。</p></div><h2 id="第三步-发布" tabindex="-1">第三步：发布！ <a class="header-anchor" href="#第三步-发布" aria-label="Permalink to &quot;第三步：发布！&quot;">​</a></h2><p>配置完成后，执行以下命令即可触发发布流程：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.0.0</span></span></code></pre></div><p>推送 <code>v*</code> 格式的 tag 后，CI 将自动完成后续所有步骤。</p><p>你也可以在 GitHub 仓库页面的 <strong>Actions</strong> 标签页中，手动触发 <code>Build and Release</code> 工作流并填入版本号。</p><h2 id="ci-工作流详解" tabindex="-1">CI 工作流详解 <a class="header-anchor" href="#ci-工作流详解" aria-label="Permalink to &quot;CI 工作流详解&quot;">​</a></h2><h3 id="release-yml-—-自动构建与发布" tabindex="-1">release.yml — 自动构建与发布 <a class="header-anchor" href="#release-yml-—-自动构建与发布" aria-label="Permalink to &quot;release.yml — 自动构建与发布&quot;">​</a></h3><p>这个工作流在你推送 <code>v*</code> tag 或手动触发时执行，完成以下任务：</p>`,27)),(d(),r(h,null,{default:i(()=>[a(p,{id:"mermaid-256",class:"mermaid my-class",graph:"flowchart%20LR%0A%20%20%20%20A%5B%22Checkout%20%E4%BB%A3%E7%A0%81%22%5D%20--%3E%20B%5B%22%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%22%5D%0A%20%20%20%20B%20--%3E%20C%5B%22%E8%AF%BB%E5%8F%96%E7%89%88%E6%9C%AC%E5%8F%B7%22%5D%0A%20%20%20%20C%20--%3E%20D%5B%22%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%22%5D%0A%20%20%20%20D%20--%3E%20E%5B%22%E6%89%93%E5%8C%85%20zip%22%5D%0A%20%20%20%20E%20--%3E%20F%5B%22%E7%94%9F%E6%88%90%20Release%20Note%22%5D%0A%20%20%20%20F%20--%3E%20G%5B%22%E5%88%9B%E5%BB%BA%20GitHub%20Release%22%5D%0A%20%20%20%20G%20--%3E%20H%5B%22%E8%A7%A6%E5%8F%91%E7%B4%A2%E5%BC%95%E6%9B%B4%E6%96%B0%22%5D%0A"})]),fallback:i(()=>[...e[7]||(e[7]=[s(" Loading... ",-1)])]),_:1})),e[38]||(e[38]=n(`<h4 id="核心步骤说明" tabindex="-1">核心步骤说明 <a class="header-anchor" href="#核心步骤说明" aria-label="Permalink to &quot;核心步骤说明&quot;">​</a></h4><p><strong>1. 版本号解析</strong></p><p>CI 会按优先级获取版本号：</p><ul><li>手动触发时输入的版本号</li><li>tag 名称（如 <code>v1.0.0</code> → <code>1.0.0</code>）</li><li>自动生成时间戳版本（兜底）</li></ul><p><strong>2. 构建与打包</strong></p><p>执行 <code>pnpm run build</code> 构建项目后，自动将产物打包为 zip 文件：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span>release/</span></span>
<span class="line"><span>├── index.mjs       # 插件主入口</span></span>
<span class="line"><span>├── package.json    # 精简后的 package.json</span></span>
<span class="line"><span>└── webui/          # WebUI 构建产物（如有）</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">修改插件名称</p><p>如果你的插件不叫 <code>napcat-plugin-template</code>，需要修改 <code>release.yml</code> 中 <strong>Prepare release package</strong> 步骤的 <code>PLUGIN_NAME</code> 环境变量为你的实际插件名。</p></div><p><strong>3. Release Note 生成</strong></p><ul><li>如果配置了 AI Secret → 使用 AI 根据 commit 记录生成结构化 Release Note</li><li>如果未配置或 AI 调用失败 → 使用 <code>.github/prompt/default.md</code> 模板回退</li><li>如果模板也不存在 → 直接使用 commit log</li></ul><p>你可以自定义 AI 的提示词，在 <code>.github/prompt/release_note_prompt.txt</code> 文件中修改即可。</p><p><strong>4. 触发索引更新</strong></p><p>Release 创建成功后，会通过 <code>workflow_dispatch</code> 自动触发 <code>update-index.yml</code> 工作流。</p><div class="info custom-block"><p class="custom-block-title">为什么要手动触发？</p><p>因为 GitHub Actions 中，由默认 <code>GITHUB_TOKEN</code> 创建的 Release <strong>不会</strong>自动触发 <code>on.release</code> 事件。所以 <code>release.yml</code> 在最后一步通过 API 手动触发索引更新工作流。</p></div><h3 id="update-index-yml-—-自动更新插件索引" tabindex="-1">update-index.yml — 自动更新插件索引 <a class="header-anchor" href="#update-index-yml-—-自动更新插件索引" aria-label="Permalink to &quot;update-index.yml — 自动更新插件索引&quot;">​</a></h3><p>这个工作流在 Release 发布后被触发，完成以下任务：</p>`,16)),(d(),r(h,null,{default:i(()=>[a(p,{id:"mermaid-335",class:"mermaid my-class",graph:"flowchart%20LR%0A%20%20%20%20A%5B%22%E8%AF%BB%E5%8F%96%20package.json%5Cn%E5%85%83%E4%BF%A1%E6%81%AF%22%5D%20--%3E%20B%5B%22%E6%9E%84%E9%80%A0%E4%B8%8B%E8%BD%BD%E9%93%BE%E6%8E%A5%22%5D%0A%20%20%20%20B%20--%3E%20C%5B%22%E9%AA%8C%E8%AF%81%E8%B5%84%E6%BA%90%E5%8F%AF%E8%BE%BE%22%5D%0A%20%20%20%20C%20--%3E%20D%5B%22%E6%9B%B4%E6%96%B0%5Cnplugins.v4.json%22%5D%0A%20%20%20%20D%20--%3E%20E%5B%22%E5%90%91%E7%B4%A2%E5%BC%95%E4%BB%93%E5%BA%93%5Cn%E6%8F%90%E4%BA%A4%20PR%22%5D%0A"})]),fallback:i(()=>[...e[8]||(e[8]=[s(" Loading... ",-1)])]),_:1})),e[39]||(e[39]=n('<h4 id="核心步骤说明-1" tabindex="-1">核心步骤说明 <a class="header-anchor" href="#核心步骤说明-1" aria-label="Permalink to &quot;核心步骤说明&quot;">​</a></h4><p><strong>1. 提取元信息</strong></p><p>CI 会从你的 <code>package.json</code> 中自动读取：</p><table tabindex="0"><thead><tr><th>字段来源</th><th>映射到索引字段</th></tr></thead><tbody><tr><td><code>name</code></td><td><code>id</code></td></tr><tr><td><code>plugin</code> (或 <code>name</code>)</td><td><code>name</code></td></tr><tr><td><code>description</code></td><td><code>description</code></td></tr><tr><td><code>author</code></td><td><code>author</code></td></tr><tr><td><code>napcat.tags</code></td><td><code>tags</code></td></tr><tr><td><code>napcat.minVersion</code></td><td><code>minVersion</code></td></tr><tr><td><code>napcat.homepage</code> (或 <code>homepage</code>)</td><td><code>homepage</code></td></tr></tbody></table><p>下载链接会自动构造为：<code>https://github.com/&lt;你的仓库&gt;/releases/download/&lt;版本号&gt;/&lt;插件ID&gt;.zip</code></p><p><strong>2. 验证资源可达</strong></p><p>CI 会 curl 检查下载链接是否可访问。如果第一次失败，会等待 30 秒后重试（因为 Release 资源上传可能有延迟）。两次都失败则跳过索引更新。</p><p><strong>3. 提交 PR</strong></p>',8)),t("p",null,[e[10]||(e[10]=s("CI 会 checkout 索引仓库 ",-1)),a(l,{href:"https://github.com/NapNeko/napcat-plugin-index",target:"_blank",rel:"noreferrer"},{default:i(()=>[...e[9]||(e[9]=[s("napcat-plugin-index",-1)])]),_:1}),e[11]||(e[11]=s("，使用 Node.js 脚本更新 ",-1)),e[12]||(e[12]=t("code",null,"plugins.v4.json",-1)),e[13]||(e[13]=s(" 文件：",-1))]),e[40]||(e[40]=t("ul",null,[t("li",null,"如果插件 ID 已存在 → 更新该条目"),t("li",null,"如果是新插件 → 追加到列表")],-1)),t("p",null,[e[15]||(e[15]=s("然后通过 ",-1)),a(l,{href:"https://github.com/peter-evans/create-pull-request",target:"_blank",rel:"noreferrer"},{default:i(()=>[...e[14]||(e[14]=[s("peter-evans/create-pull-request",-1)])]),_:1}),e[16]||(e[16]=s(" Action 自动创建 PR。",-1))]),e[41]||(e[41]=t("h2",{id:"索引仓库的自动审核",tabindex:"-1"},[s("索引仓库的自动审核 "),t("a",{class:"header-anchor",href:"#索引仓库的自动审核","aria-label":'Permalink to "索引仓库的自动审核"'},"​")],-1)),t("p",null,[e[18]||(e[18]=s("你的 PR 提交到 ",-1)),a(l,{href:"https://github.com/NapNeko/napcat-plugin-index",target:"_blank",rel:"noreferrer"},{default:i(()=>[...e[17]||(e[17]=[s("napcat-plugin-index",-1)])]),_:1}),e[19]||(e[19]=s(" 后，索引仓库有一套完善的自动化审核流程：",-1))]),e[42]||(e[42]=n('<table tabindex="0"><thead><tr><th>工作流</th><th>触发条件</th><th>功能</th></tr></thead><tbody><tr><td><strong>PR 自动审核</strong> (<code>validate-pr.yml</code>)</td><td>PR 修改 <code>plugins.v4.json</code></td><td>校验 JSON 格式、字段完整性、ID 唯一性、版本号格式、包名规范、下载链接可达性</td></tr><tr><td><strong>校验结果评论</strong> (<code>comment-on-pr.yml</code>)</td><td>审核完成后</td><td>在 PR 中评论校验结果，自动打标签（新插件 / 插件更新 / 插件删除）</td></tr><tr><td><strong>AI 安全审计</strong> (<code>security-scan.yml</code>)</td><td>PR 更新/新增插件</td><td>下载插件 zip 进行静态代码分析 + AI 深度审查，检测高危代码</td></tr><tr><td><strong>链接定时巡检</strong> (<code>check-links.yml</code>)</td><td>每天定时执行</td><td>检查所有已索引插件的下载链接是否有效，失效时自动创建 Issue</td></tr></tbody></table><h3 id="审核结果" tabindex="-1">审核结果 <a class="header-anchor" href="#审核结果" aria-label="Permalink to &quot;审核结果&quot;">​</a></h3><ul><li><strong>校验通过 + 无安全风险</strong> → 低风险 PR 自动合并，或等待维护者审核合并</li><li><strong>校验未通过</strong> → Bot 会在 PR 下评论具体的错误信息，你需要修复后重新提交</li><li><strong>发现高危代码</strong> → 需要人工审核</li></ul>',3)),t("div",m,[e[27]||(e[27]=t("p",{class:"custom-block-title"},"常见校验失败原因",-1)),t("ul",null,[e[23]||(e[23]=t("li",null,[s("插件 ID 不符合 "),t("code",null,"napcat-plugin-xxx"),s(" 格式")],-1)),e[24]||(e[24]=t("li",null,"必填字段为空",-1)),e[25]||(e[25]=t("li",null,[t("code",null,"downloadUrl"),s(" 不是可访问的 "),t("code",null,".zip"),s(" 链接")],-1)),t("li",null,[e[21]||(e[21]=s("版本号不符合 ",-1)),a(l,{href:"https://semver.org/",target:"_blank",rel:"noreferrer"},{default:i(()=>[...e[20]||(e[20]=[s("semver",-1)])]),_:1}),e[22]||(e[22]=s(" 格式",-1))]),e[26]||(e[26]=t("li",null,[s("插件包内 "),t("code",null,"package.json"),s(" 的 "),t("code",null,"name"),s(" 与索引中的 "),t("code",null,"id"),s(" 不一致")],-1))])]),e[43]||(e[43]=n(`<h2 id="版本更新发布" tabindex="-1">版本更新发布 <a class="header-anchor" href="#版本更新发布" aria-label="Permalink to &quot;版本更新发布&quot;">​</a></h2><p>后续版本更新流程与首次发布完全一致：</p><ol><li>修改 <code>package.json</code> 中的 <code>version</code>（可选，CI 会以 tag 为准）</li><li>推送新 tag：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.1.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.1.0</span></span></code></pre></div></li><li>CI 自动构建、发布、更新索引</li></ol><h2 id="自定义-release-note-模板" tabindex="-1">自定义 Release Note 模板 <a class="header-anchor" href="#自定义-release-note-模板" aria-label="Permalink to &quot;自定义 Release Note 模板&quot;">​</a></h2><h3 id="默认模板" tabindex="-1">默认模板 <a class="header-anchor" href="#默认模板" aria-label="Permalink to &quot;默认模板&quot;">​</a></h3><p>在 <code>.github/prompt/default.md</code> 中自定义默认 Release Note 模板，支持 <code>{VERSION}</code> 占位符：</p><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## {VERSION}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 核心更新</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 更新版本至 {VERSION}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 安装说明</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">1.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 下载 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\`你的插件名.zip\`</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">2.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 解压到 NapCat 的 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\`plugins\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 目录</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">3.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 重启 NapCat</span></span></code></pre></div><h3 id="ai-prompt-自定义" tabindex="-1">AI Prompt 自定义 <a class="header-anchor" href="#ai-prompt-自定义" aria-label="Permalink to &quot;AI Prompt 自定义&quot;">​</a></h3><p>在 <code>.github/prompt/release_note_prompt.txt</code> 中自定义 AI 生成 Release Note 的 system prompt，支持 <code>{VERSION}</code> 和 <code>{PREV_VERSION}</code> 占位符。</p><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><h3 id="q-能不能手动提交-pr-到索引仓库" tabindex="-1">Q: 能不能手动提交 PR 到索引仓库？ <a class="header-anchor" href="#q-能不能手动提交-pr-到索引仓库" aria-label="Permalink to &quot;Q: 能不能手动提交 PR 到索引仓库？&quot;">​</a></h3><p>不建议。索引仓库已采用全自动审核机制，手动提交的 PR 将不会被合入。请使用模板仓库的 CI 自动提交流程。</p><p>如果你不想使用模板仓库，请自行实现等效的 CI 工作流。</p><h3 id="q-不用模板仓库-自己写-ci-行不行" tabindex="-1">Q: 不用模板仓库，自己写 CI 行不行？ <a class="header-anchor" href="#q-不用模板仓库-自己写-ci-行不行" aria-label="Permalink to &quot;Q: 不用模板仓库，自己写 CI 行不行？&quot;">​</a></h3><p>可以，只要你的 CI 能够：</p><ol><li>构建产物并打包为 <code>&lt;插件ID&gt;.zip</code>（包含 <code>index.mjs</code>、<code>package.json</code>、<code>webui/</code>）</li><li>创建 GitHub Release 并上传 zip</li><li>向 <code>NapNeko/napcat-plugin-index</code> 仓库提交 PR，更新 <code>plugins.v4.json</code></li></ol>`,16)),t("p",null,[e[30]||(e[30]=s("可以参考模板仓库的 ",-1)),a(l,{href:"https://github.com/NapNeko/napcat-plugin-template/blob/main/.github/workflows/release.yml",target:"_blank",rel:"noreferrer"},{default:i(()=>[...e[28]||(e[28]=[s("release.yml",-1)])]),_:1}),e[31]||(e[31]=s(" 和 ",-1)),a(l,{href:"https://github.com/NapNeko/napcat-plugin-template/blob/main/.github/workflows/update-index.yml",target:"_blank",rel:"noreferrer"},{default:i(()=>[...e[29]||(e[29]=[s("update-index.yml",-1)])]),_:1}),e[32]||(e[32]=s("。",-1))]),e[44]||(e[44]=n('<h3 id="q-index-pat-token-过期了怎么办" tabindex="-1">Q: INDEX_PAT Token 过期了怎么办？ <a class="header-anchor" href="#q-index-pat-token-过期了怎么办" aria-label="Permalink to &quot;Q: INDEX_PAT Token 过期了怎么办？&quot;">​</a></h3><p>重新生成一个新的 PAT，更新仓库 Secret 即可。建议设置较长的过期时间，或使用 Fine-grained Token。</p><h3 id="q-release-发布了但索引没更新" tabindex="-1">Q: Release 发布了但索引没更新？ <a class="header-anchor" href="#q-release-发布了但索引没更新" aria-label="Permalink to &quot;Q: Release 发布了但索引没更新？&quot;">​</a></h3><p>检查 Actions 页面中 <code>update-index.yml</code> 的运行日志。常见原因：</p><ul><li><code>INDEX_PAT</code> 未配置或已过期</li><li>下载链接验证失败（Release 资源尚未上传完成）</li><li><code>package.json</code> 中缺少必要字段</li></ul><h3 id="q-下载链接验证失败" tabindex="-1">Q: 下载链接验证失败？ <a class="header-anchor" href="#q-下载链接验证失败" aria-label="Permalink to &quot;Q: 下载链接验证失败？&quot;">​</a></h3><p>GitHub Release 资源上传可能有延迟。CI 已内置 30 秒重试机制。如果仍失败，可以等资源上传完成后手动触发 <code>update-index.yml</code> 工作流。</p>',7)),a(c)])}const I=g(E,[["render",A]]);export{P as __pageData,I as default};
