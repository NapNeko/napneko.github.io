import{_ as e,C as h,o as d,c as r,j as i,a,E as n,w as l,aD as p}from"./chunks/framework.BeKdlGsR.js";const D=JSON.parse('{"title":"NapCat 插件开发概览","description":"","frontmatter":{},"headers":[],"relativePath":"develop/plugin/index.md","filePath":"develop/plugin/index.md","lastUpdated":1770492615000}'),E={name:"develop/plugin/index.md"},g={class:"tip custom-block"},o={class:"tip custom-block"};function y(c,s,F,u,C,A){const k=h("NolebasePageProperties"),t=h("VPNolebaseInlineLinkPreview");return d(),r("div",null,[s[35]||(s[35]=i("h1",{id:"napcat-插件开发概览",tabindex:"-1"},[a("NapCat 插件开发概览 "),i("a",{class:"header-anchor",href:"#napcat-插件开发概览","aria-label":'Permalink to "NapCat 插件开发概览"'},"​")],-1)),n(k),s[36]||(s[36]=i("p",null,"NapCat 提供了一套灵活的插件系统，支持开发者扩展 Bot 的功能。本文档介绍 NapCat 插件的开发流程。",-1)),i("div",g,[s[3]||(s[3]=i("p",{class:"custom-block-title"},"前置知识",-1)),i("p",null,[s[1]||(s[1]=a("如果你还不了解 NapCat 插件系统的工作原理，建议先阅读 ",-1)),n(t,{href:"./mechanism"},{default:l(()=>[...s[0]||(s[0]=[a("插件机制原理",-1)])]),_:1}),s[2]||(s[2]=a("。",-1))])]),i("div",o,[s[7]||(s[7]=i("p",{class:"custom-block-title"},"说明",-1)),i("p",null,[s[5]||(s[5]=a("推荐使用 ",-1)),n(t,{href:"https://github.com/NapNeko/napcat-plugin-template",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[4]||(s[4]=[a("napcat-plugin-template",-1)])]),_:1}),s[6]||(s[6]=a(" 模板仓库快速开始开发。",-1))])]),s[37]||(s[37]=i("h2",{id:"开发前准备",tabindex:"-1"},[a("开发前准备 "),i("a",{class:"header-anchor",href:"#开发前准备","aria-label":'Permalink to "开发前准备"'},"​")],-1)),s[38]||(s[38]=i("p",null,"在开始开发之前，你需要了解以下资源：",-1)),i("ul",null,[i("li",null,[i("strong",null,[n(t,{href:"https://github.com/NapNeko/napcat-plugin-template",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[8]||(s[8]=[a("napcat-plugin-template",-1)])]),_:1})]),s[9]||(s[9]=a(": 官方提供的插件开发模板，内置了构建流程和 CI/CD，推荐使用。",-1))]),i("li",null,[i("strong",null,[n(t,{href:"https://github.com/NapNeko/napcat-plugin-index",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[10]||(s[10]=[a("napcat-plugin-index",-1)])]),_:1})]),s[11]||(s[11]=a(": 插件索引仓库，发布后的插件会收录在这里。",-1))])]),s[39]||(s[39]=i("h2",{id:"快速开始",tabindex:"-1"},[a("快速开始 "),i("a",{class:"header-anchor",href:"#快速开始","aria-label":'Permalink to "快速开始"'},"​")],-1)),s[40]||(s[40]=i("h3",{id:"_1-使用模板创建项目",tabindex:"-1"},[a("1. 使用模板创建项目 "),i("a",{class:"header-anchor",href:"#_1-使用模板创建项目","aria-label":'Permalink to "1. 使用模板创建项目"'},"​")],-1)),i("p",null,[s[13]||(s[13]=a("最简单的方式是直接通过 ",-1)),n(t,{href:"https://github.com/NapNeko/napcat-plugin-template",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[12]||(s[12]=[a("napcat-plugin-template",-1)])]),_:1}),s[14]||(s[14]=a(" 创建你的 GitHub 仓库。该模板提供了完整的开发环境配置，包括 TypeScript 支持、构建脚本以及 CI/CD 流程。",-1))]),s[41]||(s[41]=p(`<h3 id="_2-项目结构说明" tabindex="-1">2. 项目结构说明 <a class="header-anchor" href="#_2-项目结构说明" aria-label="Permalink to &quot;2. 项目结构说明&quot;">​</a></h3><p>一个标准的 NapCat 插件项目结构如下 (以模板为例)：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span>napcat-plugin-template/</span></span>
<span class="line"><span>├── src/</span></span>
<span class="line"><span>│   ├── index.ts              # 插件主入口，负责导出生命周期函数</span></span>
<span class="line"><span>│   ├── config.ts             # 配置文件定义及 WebUI Schema</span></span>
<span class="line"><span>│   ├── types.ts              # TypeScript 类型定义</span></span>
<span class="line"><span>│   ├── core/</span></span>
<span class="line"><span>│   │   └── state.ts          # 全局状态管理</span></span>
<span class="line"><span>│   ├── handlers/             # 业务逻辑处理模块</span></span>
<span class="line"><span>│   │   └── message-handler.ts # 示例：消息处理器</span></span>
<span class="line"><span>│   ├── services/             # 服务层，API 路由等</span></span>
<span class="line"><span>│   └── webui/                # (可选) 插件的 WebUI 前端代码</span></span>
<span class="line"><span>├── package.json              # 项目依赖及元数据</span></span>
<span class="line"><span>└── tsconfig.json             # TypeScript 配置</span></span></code></pre></div><h2 id="编写核心逻辑" tabindex="-1">编写核心逻辑 <a class="header-anchor" href="#编写核心逻辑" aria-label="Permalink to &quot;编写核心逻辑&quot;">​</a></h2><p>在 <code>src/index.ts</code> 中，你需要导出插件的生命周期函数。这是插件被 NapCat 加载时执行的入口点。请务必遵循 NapCat 的生命周期。</p><h3 id="插件入口-src-index-ts" tabindex="-1">插件入口 (<code>src/index.ts</code>) <a class="header-anchor" href="#插件入口-src-index-ts" aria-label="Permalink to &quot;插件入口 (\`src/index.ts\`)&quot;">​</a></h3><p>插件需要导出 <code>PluginModule</code> 接口中定义的生命周期函数。其中 <code>plugin_init</code> 是唯一必选的函数。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { PluginModule, OB11Message, OB11PostSendMsg } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;napcat-types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { EventType } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;napcat-types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. 插件初始化（必选）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 插件加载时调用，用于初始化资源、注册路由等</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> plugin_init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PluginModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;plugin_init&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ctx.logger.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;My Plugin has been initialized!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 初始化时可以做一些准备工作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. 消息处理（可选）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 收到事件时调用，需要通过 post_type 判断是否为消息事件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> plugin_onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PluginModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;plugin_onmessage&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 过滤非消息事件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.post_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EventType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MESSAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 简单的 Ping-Pong 示例</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.raw_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ping&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ctx.logger.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`收到来自 \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">event</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} 的 ping\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 构造发送消息的参数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OB11PostSendMsg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pong&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            message_type: event.message_type,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.message_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;group&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.group_id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                ?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { group_id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.group_id) }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.message_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;private&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.user_id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                ?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { user_id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.user_id) }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        };</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 通过 actions 调用 OneBot11 Action (需传入 adapter 和 config)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.actions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;send_msg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, params, ctx.adapterName, ctx.pluginManager.config);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. 事件处理（可选）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 处理所有 OneBot 事件（包括通知、请求等）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> plugin_onevent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PluginModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;plugin_onevent&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ctx.logger.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;收到事件:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, event);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4. 插件卸载（可选）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 插件重载或卸载时调用，必须清理定时器、关闭连接等</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> plugin_cleanup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PluginModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;plugin_cleanup&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ctx.logger.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;My Plugin is cleaning up...&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 清理资源</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">关于 actions.call 调用</p><p><code>ctx.actions.call(actionName, params, adapter, config)</code> 需要 4 个参数：</p><ul><li><code>actionName</code>: OneBot11 Action 名称（如 <code>&#39;send_msg&#39;</code>、<code>&#39;get_login_info&#39;</code> 等）</li><li><code>params</code>: 请求参数</li><li><code>adapter</code>: 适配器名称，使用 <code>ctx.adapterName</code></li><li><code>config</code>: 网络配置，使用 <code>ctx.pluginManager.config</code></li></ul></div><h3 id="生命周期函数一览" tabindex="-1">生命周期函数一览 <a class="header-anchor" href="#生命周期函数一览" aria-label="Permalink to &quot;生命周期函数一览&quot;">​</a></h3><table tabindex="0"><thead><tr><th>函数名</th><th>是否必选</th><th>说明</th></tr></thead><tbody><tr><td><code>plugin_init</code></td><td>必选</td><td>插件加载时调用，用于初始化</td></tr><tr><td><code>plugin_onmessage</code></td><td>可选</td><td>收到事件时调用（需通过 <code>post_type</code> 判断事件类型）</td></tr><tr><td><code>plugin_onevent</code></td><td>可选</td><td>收到所有 OneBot 事件时调用</td></tr><tr><td><code>plugin_cleanup</code></td><td>可选</td><td>插件卸载/重载时调用</td></tr><tr><td><code>plugin_config_schema</code></td><td>可选</td><td>导出配置 Schema（同 <code>plugin_config_ui</code>）</td></tr><tr><td><code>plugin_config_ui</code></td><td>可选</td><td>导出配置 Schema，用于在 WebUI 生成配置面板</td></tr><tr><td><code>plugin_get_config</code></td><td>可选</td><td>获取插件配置的自定义实现</td></tr><tr><td><code>plugin_set_config</code></td><td>可选</td><td>保存插件配置的自定义实现</td></tr><tr><td><code>plugin_config_controller</code></td><td>可选</td><td>配置 UI 控制器，用于动态控制配置界面</td></tr><tr><td><code>plugin_on_config_change</code></td><td>可选</td><td>配置变更时触发的回调</td></tr></tbody></table><h3 id="消息处理的最佳实践" tabindex="-1">消息处理的最佳实践 <a class="header-anchor" href="#消息处理的最佳实践" aria-label="Permalink to &quot;消息处理的最佳实践&quot;">​</a></h3><p>为了保持代码整洁，建议将复杂的业务逻辑分离到 <code>src/handlers</code> 目录下的独立文件中，而不是全部写在 <code>plugin_onmessage</code> 里。</p><p>例如创建 <code>src/handlers/message.ts</code>：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { NapCatPluginContext, OB11Message, OB11PostSendMsg } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;napcat-types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleGroupMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NapCatPluginContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OB11Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">raw_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">group_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 封装发送群消息的辅助函数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendGroupMsg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OB11PostSendMsg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: text,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message_type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;group&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      group_id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(group_id),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.actions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;send_msg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, params, ctx.adapterName, ctx.pluginManager.config);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 示例：简单的关键词回复</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (raw_message.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;喵&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendGroupMsg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;喵喵喵？&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 示例：调用 OneBot 11 Action</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (raw_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#info&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> loginInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.actions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &#39;get_login_info&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ctx.adapterName, ctx.pluginManager.config</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     );</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendGroupMsg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`当前登录账号: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">loginInfo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nickname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} (\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">loginInfo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">})\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>然后在 <code>index.ts</code> 中引入使用：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { PluginModule } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;napcat-types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { EventType } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;napcat-types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { handleGroupMessage } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./handlers/message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> plugin_onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PluginModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;plugin_onmessage&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.post_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EventType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MESSAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.message_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;group&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleGroupMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, event);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h3 id="napcatplugincontext-核心属性" tabindex="-1">NapCatPluginContext 核心属性 <a class="header-anchor" href="#napcatplugincontext-核心属性" aria-label="Permalink to &quot;NapCatPluginContext 核心属性&quot;">​</a></h3><p><code>NapCatPluginContext</code> 是插件开发中最重要的上下文对象，包含以下属性：</p><ul><li><strong><code>ctx.core</code></strong>: <code>NapCatCore</code> 实例，底层核心。</li><li><strong><code>ctx.oneBot</code></strong>: <code>NapCatOneBot11Adapter</code> 实例，OneBot11 适配器。</li><li><strong><code>ctx.actions</code></strong>: <code>ActionMap</code> 对象，通过 <code>ctx.actions.call(actionName, params, ctx.adapterName, ctx.pluginManager.config)</code> 调用 OneBot11 Action。</li><li><strong><code>ctx.pluginName</code></strong>: 当前插件名称。</li><li><strong><code>ctx.pluginPath</code></strong>: 插件所在目录路径。</li><li><strong><code>ctx.configPath</code></strong>: 插件配置文件路径。</li><li><strong><code>ctx.dataPath</code></strong>: 插件数据存储目录路径。</li><li><strong><code>ctx.NapCatConfig</code></strong>: 配置构建工具类，提供 <code>text</code>/<code>number</code>/<code>boolean</code>/<code>select</code> 等静态方法。</li><li><strong><code>ctx.adapterName</code></strong>: 适配器名称。</li><li><strong><code>ctx.pluginManager</code></strong>: 插件管理器，支持查询/启停其他插件。</li><li><strong><code>ctx.logger</code></strong>: 使用 NapCat 内置的日志系统，保持日志格式统一。</li><li><strong><code>ctx.router</code></strong>: 路由注册器，用于注册 API 路由、页面和静态文件。</li><li><strong><code>ctx.getPluginExports(pluginId)</code></strong>: 获取其他已加载插件的导出对象。</li></ul><h2 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;配置文件&quot;">​</a></h2><p>NapCat 插件支持通过导出 <code>plugin_config_ui</code> 或 <code>plugin_config_schema</code> 来定义配置项。这允许用户在 WebUI 中修改插件的设置。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { PluginConfigSchema } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;napcat-types&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> plugin_config_ui</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PluginConfigSchema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    key: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;enable&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;启用插件&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;boolean&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    default: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    description: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;是否启用本插件的核心功能&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    key: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;prefix&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;命令前缀&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;string&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    default: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    placeholder: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;请输入命令前缀，例如 / 或 #&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    description: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;触发命令的前缀符号&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre></div><h2 id="webui-开发-可选" tabindex="-1">WebUI 开发 (可选) <a class="header-anchor" href="#webui-开发-可选" aria-label="Permalink to &quot;WebUI 开发 (可选)&quot;">​</a></h2><p>如果插件需要提供图形化界面，可以在 <code>src/webui</code> 目录下进行 React 开发。模板中已经配置好了 Vite 构建脚本，运行 <code>npm run build</code> 时，构建后的静态资源会被自动打包进插件中，用户可以通过 NapCat 的管理界面访问。</p><h2 id="发布插件" tabindex="-1">发布插件 <a class="header-anchor" href="#发布插件" aria-label="Permalink to &quot;发布插件&quot;">​</a></h2><h3 id="发布插件流程" tabindex="-1">发布插件流程 <a class="header-anchor" href="#发布插件流程" aria-label="Permalink to &quot;发布插件流程&quot;">​</a></h3>`,27)),i("ol",null,[s[19]||(s[19]=p(`<li><strong>配置 <code>package.json</code></strong>: 确保你的 <code>package.json</code> 包含正确的插件元数据：<div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;napcat-plugin-your-plugin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;plugin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;我的插件&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;index.mjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;这是我的 NapCat 插件&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;author&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;YourName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;napcat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;工具&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;娱乐&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;minVersion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4.14.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;homepage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://github.com/yourname/napcat-plugin-your-plugin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><strong>发布版本</strong>: 推送 <code>v*</code> 格式的 Git Tag (例如 <code>v1.0.0</code>) 到你的远程仓库。</li><li><strong>CI/CD 自动发布</strong>: 如果你基于模板开发并配置了 Secret，GitHub Actions 会自动构建并发布 Release。</li>`,3)),i("li",null,[s[16]||(s[16]=i("strong",null,"提交索引",-1)),s[17]||(s[17]=a(": 同时 CI 会自动向 ",-1)),n(t,{href:"https://github.com/NapNeko/napcat-plugin-index",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[15]||(s[15]=[a("napcat-plugin-index",-1)])]),_:1}),s[18]||(s[18]=a(" 提交 PR。等待维护者审核合并后，你的插件就会出现在 NapCat 的插件市场中供用户下载。",-1))])]),s[42]||(s[42]=i("h2",{id:"自动化发布-ci-cd",tabindex:"-1"},[a("自动化发布 (CI/CD) "),i("a",{class:"header-anchor",href:"#自动化发布-ci-cd","aria-label":'Permalink to "自动化发布 (CI/CD)"'},"​")],-1)),s[43]||(s[43]=i("p",null,"NapCat 插件模板内置了 GitHub Actions 工作流，可自动完成构建、发布 Release 以及提交到插件市场的全过程。",-1)),s[44]||(s[44]=i("h3",{id:"工作流介绍",tabindex:"-1"},[a("工作流介绍 "),i("a",{class:"header-anchor",href:"#工作流介绍","aria-label":'Permalink to "工作流介绍"'},"​")],-1)),s[45]||(s[45]=i("p",null,"模板仓库包含两个主要的工作流文件：",-1)),i("ol",null,[s[25]||(s[25]=p("<li><p><strong><code>release.yml</code></strong>: 负责插件的构建和 Release 发布。</p><ul><li><strong>触发条件</strong>: 当你推送 <code>v*</code> 格式的 tag (如 <code>v1.0.0</code>) 时自动触发。</li><li><strong>主要任务</strong>: <ul><li>安装依赖 (<code>pnpm install</code>)</li><li>构建插件 (<code>npm run build</code>)</li><li>打包构建产物为 <code>.zip</code> 文件</li><li>创建 GitHub Release 并上传 <code>.zip</code> 包</li></ul></li></ul></li>",1)),i("li",null,[i("p",null,[s[21]||(s[21]=i("strong",null,[i("code",null,"update-index.yml")],-1)),s[22]||(s[22]=a(": 负责将发布后的插件自动提交到 ",-1)),n(t,{href:"https://github.com/NapNeko/napcat-plugin-index",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[20]||(s[20]=[a("NapCat 插件索引仓库",-1)])]),_:1}),s[23]||(s[23]=a("。",-1))]),s[24]||(s[24]=p("<ul><li><strong>触发条件</strong>: 当 <code>release.yml</code> 成功发布 Release 后触发。</li><li><strong>主要任务</strong>: <ul><li>抓取 <code>package.json</code> 中的插件元数据 (版本、描述、作者等)</li><li>向 NapCat 插件索引仓库提交 Pull Request (PR)</li><li>等待仓库维护者审核合并</li></ul></li></ul>",1))])]),s[46]||(s[46]=i("h3",{id:"配置步骤",tabindex:"-1"},[a("配置步骤 "),i("a",{class:"header-anchor",href:"#配置步骤","aria-label":'Permalink to "配置步骤"'},"​")],-1)),s[47]||(s[47]=i("p",null,"为了让自动提交索引的功能正常工作，你需要进行少量的配置：",-1)),s[48]||(s[48]=i("h4",{id:"_1-设置-repository-secret",tabindex:"-1"},[a("1. 设置 Repository Secret "),i("a",{class:"header-anchor",href:"#_1-设置-repository-secret","aria-label":'Permalink to "1. 设置 Repository Secret"'},"​")],-1)),s[49]||(s[49]=i("p",null,"由于 GitHub Actions 默认权限无法跨仓库提交 PR，你需要提供一个具有权限的 Token。",-1)),i("ol",null,[i("li",null,[s[31]||(s[31]=i("p",null,[i("strong",null,"生成 Token"),a(":")],-1)),i("ul",null,[i("li",null,[s[27]||(s[27]=a("访问 ",-1)),n(t,{href:"https://github.com/settings/tokens",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[26]||(s[26]=[a("GitHub Developer Settings",-1)])]),_:1})]),s[28]||(s[28]=i("li",null,[a("生成一个新的 "),i("strong",null,"Personal Access Token (Classic)")],-1)),s[29]||(s[29]=i("li",null,[a("勾选 "),i("code",null,"public_repo"),a(" (对于公开仓库) 权限")],-1)),s[30]||(s[30]=i("li",null,"复制生成的 Token",-1))])]),s[32]||(s[32]=p("<li><p><strong>配置 Secret</strong>:</p><ul><li>进入你的插件仓库 -&gt; <code>Settings</code> -&gt; <code>Secrets and variables</code> -&gt; <code>Actions</code></li><li>点击 <code>New repository secret</code></li><li>Name: <code>INDEX_PAT</code> (必须完全一致)</li><li>Value: 粘贴刚才复制的 Token</li><li>点击 <code>Add secret</code> 保存</li></ul></li>",1))]),s[50]||(s[50]=p(`<h4 id="_2-完善-package-json" tabindex="-1">2. 完善 <code>package.json</code> <a class="header-anchor" href="#_2-完善-package-json" aria-label="Permalink to &quot;2. 完善 \`package.json\`&quot;">​</a></h4><p>自动化脚本会从 <code>package.json</code> 读取插件信息，请务必完整填写：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;napcat-plugin-demo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 插件ID (必须以 napcat-plugin- 开头)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;plugin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;插件显示名称&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 插件在 WebUI 中的显示名称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 版本号</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;index.mjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 入口文件</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;这是插件描述&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 插件描述</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;author&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;YourName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 作者</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;napcat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;工具&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;娱乐&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 插件标签</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;minVersion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4.14.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 最低支持的 NapCat 版本</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;homepage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://...&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         // 项目主页</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="完整的发布操作" tabindex="-1">完整的发布操作 <a class="header-anchor" href="#完整的发布操作" aria-label="Permalink to &quot;完整的发布操作&quot;">​</a></h3><p>配置完成后，发布新版本的流程如下：</p><ol><li><strong>修改版本号</strong>: 更新 <code>package.json</code> 中的 <code>version</code> 字段 (例如 <code>1.0.1</code>)。</li><li><strong>提交代码</strong>: 将修改推送到 GitHub。</li><li><strong>打标签</strong>:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.0.1</span></span></code></pre></div></li><li><strong>等待执行</strong>: <ul><li>GitHub Actions 会自动运行 <code>release.yml</code> 构建并发布 Release。</li><li>随后触发 <code>update-index.yml</code>，自动向官方索引仓库提交 PR。</li></ul></li><li><strong>完成</strong>: 等待 PR 被合并后，插件将收录至 NapCat 插件市场。</li></ol><h2 id="另请参阅" tabindex="-1">另请参阅 <a class="header-anchor" href="#另请参阅" aria-label="Permalink to &quot;另请参阅&quot;">​</a></h2>`,7)),i("ul",null,[i("li",null,[n(t,{href:"https://github.com/NapNeko/napcat-plugin-template",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[33]||(s[33]=[a("NapCat 插件模板",-1)])]),_:1})]),i("li",null,[n(t,{href:"https://github.com/NapNeko/napcat-plugin-index",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[34]||(s[34]=[a("NapCat 插件索引",-1)])]),_:1})])])])}const B=e(E,[["render",y]]);export{D as __pageData,B as default};
