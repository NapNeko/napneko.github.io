import{_ as n,C as d,o,c as l,j as e,a as c,E as a,aD as r}from"./chunks/framework.BeKdlGsR.js";const P=JSON.parse('{"title":"NapCat 插件开发 API 参考文档","description":"","frontmatter":{},"headers":[],"relativePath":"develop/plugin/api/doc.md","filePath":"develop/plugin/api/doc.md","lastUpdated":1770492615000}'),h={name:"develop/plugin/api/doc.md"};function p(g,t,k,u,E,y){const i=d("NolebasePageProperties"),s=d("NolebaseGitChangelog");return o(),l("div",null,[t[0]||(t[0]=e("h1",{id:"napcat-插件开发-api-参考文档",tabindex:"-1"},[c("NapCat 插件开发 API 参考文档 "),e("a",{class:"header-anchor",href:"#napcat-插件开发-api-参考文档","aria-label":'Permalink to "NapCat 插件开发 API 参考文档"'},"​")],-1)),a(i),t[1]||(t[1]=r(`<h2 id="napcatplugincontext" tabindex="-1">NapCatPluginContext <a class="header-anchor" href="#napcatplugincontext" aria-label="Permalink to &quot;NapCatPluginContext&quot;">​</a></h2><p>插件的核心上下文对象，包含了几乎所有你需要的功能。在所有生命周期函数中作为第一个参数传入。</p><h3 id="属性一览" tabindex="-1">属性一览 <a class="header-anchor" href="#属性一览" aria-label="Permalink to &quot;属性一览&quot;">​</a></h3><table tabindex="0"><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>core</code></td><td><code>NapCatCore</code></td><td>NapCat 底层核心实例</td></tr><tr><td><code>oneBot</code></td><td><code>NapCatOneBot11Adapter</code></td><td>OneBot11 协议适配器</td></tr><tr><td><code>actions</code></td><td><code>ActionMap</code></td><td>OneBot11 Action 调用器</td></tr><tr><td><code>pluginName</code></td><td><code>string</code></td><td>当前插件名称</td></tr><tr><td><code>pluginPath</code></td><td><code>string</code></td><td>插件所在目录</td></tr><tr><td><code>configPath</code></td><td><code>string</code></td><td>插件配置文件路径</td></tr><tr><td><code>dataPath</code></td><td><code>string</code></td><td>插件数据存储目录</td></tr><tr><td><code>NapCatConfig</code></td><td><code>NapCatConfigClass</code></td><td>配置构建工具类</td></tr><tr><td><code>adapterName</code></td><td><code>string</code></td><td>适配器名称</td></tr><tr><td><code>pluginManager</code></td><td><code>IPluginManager</code></td><td>插件管理器</td></tr><tr><td><code>logger</code></td><td><code>PluginLogger</code></td><td>日志记录器</td></tr><tr><td><code>router</code></td><td><code>PluginRouterRegistry</code></td><td>路由注册器</td></tr><tr><td><code>getPluginExports</code></td><td><code>&lt;T&gt;(pluginId: string) =&gt; T | undefined</code></td><td>获取其他插件的导出</td></tr></tbody></table><h3 id="ctx-actions" tabindex="-1"><code>ctx.actions</code> <a class="header-anchor" href="#ctx-actions" aria-label="Permalink to &quot;\`ctx.actions\`&quot;">​</a></h3><p>OneBot11 Action 调用器。</p><p><strong>调用签名</strong>:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.actions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(actionName, params, ctx.adapterName, ctx.pluginManager.config)</span></span></code></pre></div><ul><li><code>actionName</code>: Action 名称（字符串）</li><li><code>params</code>: 请求参数（不同 action 参数不同，无参数时传 <code>void 0</code>）</li><li><code>adapter</code>: 适配器名称，使用 <code>ctx.adapterName</code></li><li><code>config</code>: 网络配置，使用 <code>ctx.pluginManager.config</code></li></ul><p><strong>常用 Action 示例</strong>:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 通用发送消息 (推荐用法)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OB11PostSendMsg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Hello&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message_type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;group&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    group_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;123456&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.actions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;send_msg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, params, ctx.adapterName, ctx.pluginManager.config);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取登录信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.actions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;get_login_info&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ctx.adapterName, ctx.pluginManager.config);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取群列表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> groups</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.actions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;get_group_list&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ctx.adapterName, ctx.pluginManager.config);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取版本信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.actions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;get_version_info&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ctx.adapterName, ctx.pluginManager.config);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 撤回消息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.actions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;delete_msg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { message_id }, ctx.adapterName, ctx.pluginManager.config);</span></span></code></pre></div><h3 id="ctx-logger" tabindex="-1"><code>ctx.logger</code> <a class="header-anchor" href="#ctx-logger" aria-label="Permalink to &quot;\`ctx.logger\`&quot;">​</a></h3><p>带有插件名称前缀的日志记录器，实现 <code>PluginLogger</code> 接口。</p><table tabindex="0"><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>log(...)</code></td><td>输出普通日志</td></tr><tr><td><code>debug(...)</code></td><td>输出调试日志（仅 debug 模式可见）</td></tr><tr><td><code>info(...)</code></td><td>输出信息日志</td></tr><tr><td><code>warn(...)</code></td><td>输出警告日志</td></tr><tr><td><code>error(...)</code></td><td>输出错误日志</td></tr></tbody></table><h3 id="ctx-pluginmanager" tabindex="-1"><code>ctx.pluginManager</code> <a class="header-anchor" href="#ctx-pluginmanager" aria-label="Permalink to &quot;\`ctx.pluginManager\`&quot;">​</a></h3><p>插件管理器接口 (<code>IPluginManager</code>)，提供对其他插件的管理能力。</p><table tabindex="0"><thead><tr><th>方法</th><th>返回值</th><th>说明</th></tr></thead><tbody><tr><td><code>getPluginPath()</code></td><td><code>string</code></td><td>获取插件根目录</td></tr><tr><td><code>getPluginConfig()</code></td><td><code>PluginStatusConfig</code></td><td>获取插件启用状态配置</td></tr><tr><td><code>getAllPlugins()</code></td><td><code>PluginEntry[]</code></td><td>获取所有已扫描的插件列表</td></tr><tr><td><code>getLoadedPlugins()</code></td><td><code>PluginEntry[]</code></td><td>获取所有已加载的插件列表</td></tr><tr><td><code>getPluginInfo(pluginId)</code></td><td><code>PluginEntry | undefined</code></td><td>获取指定插件信息</td></tr><tr><td><code>setPluginStatus(pluginId, enable)</code></td><td><code>Promise&lt;void&gt;</code></td><td>启用/禁用插件</td></tr><tr><td><code>loadPluginById(pluginId)</code></td><td><code>Promise&lt;boolean&gt;</code></td><td>加载指定插件</td></tr><tr><td><code>unregisterPlugin(pluginId)</code></td><td><code>Promise&lt;void&gt;</code></td><td>注销插件</td></tr><tr><td><code>uninstallPlugin(pluginId, cleanData?)</code></td><td><code>Promise&lt;void&gt;</code></td><td>卸载并删除插件</td></tr><tr><td><code>reloadPlugin(pluginId)</code></td><td><code>Promise&lt;boolean&gt;</code></td><td>重新加载插件</td></tr><tr><td><code>loadDirectoryPlugin(dirname)</code></td><td><code>Promise&lt;void&gt;</code></td><td>从目录加载插件</td></tr><tr><td><code>getPluginDataPath(pluginId)</code></td><td><code>string</code></td><td>获取插件数据目录</td></tr><tr><td><code>getPluginConfigPath(pluginId)</code></td><td><code>string</code></td><td>获取插件配置目录</td></tr></tbody></table><h3 id="ctx-router" tabindex="-1"><code>ctx.router</code> <a class="header-anchor" href="#ctx-router" aria-label="Permalink to &quot;\`ctx.router\`&quot;">​</a></h3><p>WebUI 和 API 路由注册器 (<code>PluginRouterRegistry</code>)。</p><h4 id="需要鉴权的路由" tabindex="-1">需要鉴权的路由 <a class="header-anchor" href="#需要鉴权的路由" aria-label="Permalink to &quot;需要鉴权的路由&quot;">​</a></h4><p>路径前缀：<code>/api/Plugin/ext/&lt;plugin-id&gt;/</code></p><table tabindex="0"><thead><tr><th>方法</th><th>签名</th><th>说明</th></tr></thead><tbody><tr><td><code>api</code></td><td><code>(method, path, handler)</code></td><td>注册指定 HTTP 方法的 API</td></tr><tr><td><code>get</code></td><td><code>(path, handler)</code></td><td>注册 GET API</td></tr><tr><td><code>post</code></td><td><code>(path, handler)</code></td><td>注册 POST API</td></tr><tr><td><code>put</code></td><td><code>(path, handler)</code></td><td>注册 PUT API</td></tr><tr><td><code>delete</code></td><td><code>(path, handler)</code></td><td>注册 DELETE API</td></tr></tbody></table><h4 id="无需鉴权的路由" tabindex="-1">无需鉴权的路由 <a class="header-anchor" href="#无需鉴权的路由" aria-label="Permalink to &quot;无需鉴权的路由&quot;">​</a></h4><p>路径前缀：<code>/plugin/&lt;plugin-id&gt;/api/</code></p><table tabindex="0"><thead><tr><th>方法</th><th>签名</th><th>说明</th></tr></thead><tbody><tr><td><code>apiNoAuth</code></td><td><code>(method, path, handler)</code></td><td>注册指定 HTTP 方法的开放 API</td></tr><tr><td><code>getNoAuth</code></td><td><code>(path, handler)</code></td><td>注册 GET 开放 API</td></tr><tr><td><code>postNoAuth</code></td><td><code>(path, handler)</code></td><td>注册 POST 开放 API</td></tr><tr><td><code>putNoAuth</code></td><td><code>(path, handler)</code></td><td>注册 PUT 开放 API</td></tr><tr><td><code>deleteNoAuth</code></td><td><code>(path, handler)</code></td><td>注册 DELETE 开放 API</td></tr></tbody></table><h4 id="页面与静态文件" tabindex="-1">页面与静态文件 <a class="header-anchor" href="#页面与静态文件" aria-label="Permalink to &quot;页面与静态文件&quot;">​</a></h4><table tabindex="0"><thead><tr><th>方法</th><th>签名</th><th>路径前缀</th><th>说明</th></tr></thead><tbody><tr><td><code>page</code></td><td><code>(pageDefinition)</code></td><td><code>/plugin/&lt;plugin-id&gt;/page/&lt;path&gt;</code></td><td>注册页面</td></tr><tr><td><code>pages</code></td><td><code>(pageDefinitions)</code></td><td>同上</td><td>批量注册页面</td></tr><tr><td><code>static</code></td><td><code>(urlPath, localPath)</code></td><td><code>/plugin/&lt;plugin-id&gt;/files/&lt;urlPath&gt;/</code></td><td>注册本地静态文件服务</td></tr><tr><td><code>staticOnMem</code></td><td><code>(urlPath, files)</code></td><td><code>/plugin/&lt;plugin-id&gt;/mem/&lt;urlPath&gt;/</code></td><td>注册内存静态文件服务</td></tr></tbody></table><h3 id="ctx-napcatconfig" tabindex="-1"><code>ctx.NapCatConfig</code> <a class="header-anchor" href="#ctx-napcatconfig" aria-label="Permalink to &quot;\`ctx.NapCatConfig\`&quot;">​</a></h3><p>配置构建工具类，提供便捷的静态方法生成 <code>PluginConfigItem</code>：</p><table tabindex="0"><thead><tr><th>方法</th><th>签名</th><th>说明</th></tr></thead><tbody><tr><td><code>text</code></td><td><code>(key, label, defaultValue?, description?, reactive?)</code></td><td>文本输入</td></tr><tr><td><code>number</code></td><td><code>(key, label, defaultValue?, description?, reactive?)</code></td><td>数字输入</td></tr><tr><td><code>boolean</code></td><td><code>(key, label, defaultValue?, description?, reactive?)</code></td><td>布尔开关</td></tr><tr><td><code>select</code></td><td><code>(key, label, options, defaultValue?, description?, reactive?)</code></td><td>下拉单选</td></tr><tr><td><code>multiSelect</code></td><td><code>(key, label, options, defaultValue?, description?, reactive?)</code></td><td>下拉多选</td></tr><tr><td><code>html</code></td><td><code>(content)</code></td><td>HTML 展示</td></tr><tr><td><code>plainText</code></td><td><code>(content)</code></td><td>纯文本展示</td></tr><tr><td><code>combine</code></td><td><code>(...items)</code></td><td>合并多个配置项为 Schema</td></tr></tbody></table><h3 id="ctx-getpluginexports" tabindex="-1"><code>ctx.getPluginExports</code> <a class="header-anchor" href="#ctx-getpluginexports" aria-label="Permalink to &quot;\`ctx.getPluginExports\`&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getPluginExports&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PluginModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pluginId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span></span></code></pre></div><p>获取其他已加载插件的导出模块对象。支持泛型参数以获得类型提示。</p><h2 id="ob11message-消息对象" tabindex="-1">OB11Message 消息对象 <a class="header-anchor" href="#ob11message-消息对象" aria-label="Permalink to &quot;OB11Message 消息对象&quot;">​</a></h2><p>当收到 <code>plugin_onmessage</code> 事件时，传递的消息对象。</p><h3 id="属性" tabindex="-1">属性 <a class="header-anchor" href="#属性" aria-label="Permalink to &quot;属性&quot;">​</a></h3><table tabindex="0"><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>message_id</code></td><td><code>number</code></td><td>消息 ID</td></tr><tr><td><code>user_id</code></td><td><code>number</code></td><td>发送者 QQ</td></tr><tr><td><code>group_id</code></td><td><code>number</code></td><td>群号（私聊时为 0）</td></tr><tr><td><code>message_type</code></td><td><code>&#39;private&#39; | &#39;group&#39;</code></td><td>消息类型</td></tr><tr><td><code>raw_message</code></td><td><code>string</code></td><td>原始消息文本</td></tr><tr><td><code>message</code></td><td><code>MessageSegment[]</code></td><td>消息段数组</td></tr><tr><td><code>sender</code></td><td><code>OB11Sender</code></td><td>发送者信息</td></tr><tr><td><code>time</code></td><td><code>number</code></td><td>时间戳</td></tr></tbody></table><hr><p>更多详细类型定义请参考 TypeScript 提示或查阅 <code>napcat-types</code> 包。</p>`,39)),a(s)])}const m=n(h,[["render",p]]);export{P as __pageData,m as default};
